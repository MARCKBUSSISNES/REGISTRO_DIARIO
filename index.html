<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Control de Ventas Diarias - Tech</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
    body {
        font-family: 'Orbitron', sans-serif;
        background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: flex-start;
        min-height: 100vh;
        color: #e0e0e0;
    }

    .container {
        background-color: rgba(20,20,20,0.95);
        padding: 30px;
        margin: 20px;
        border-radius: 15px;
        width: 95%;
        max-width: 1000px;
        box-shadow: 0 0 30px rgba(0,255,180,0.5);
        transition: all 0.5s ease;
    }

    h1 {
        text-align: center;
        color: #00ffb3;
        margin-bottom: 25px;
        text-shadow: 0 0 10px #00ffb3;
    }

    input, button {
        padding: 12px;
        font-size: 16px;
        border-radius: 8px;
        border: none;
        outline: none;
        transition: 0.3s;
    }

    input {
        background-color: #111;
        color: #fff;
        border: 1px solid #00ffb3;
    }

    input:focus {
        border-color: #00d1a3;
        box-shadow: 0 0 10px #00d1a3;
    }

    button {
        cursor: pointer;
        font-weight: bold;
    }

    #login button {
        background-color: #00ffb3;
        color: #111;
    }

    #login button:hover { background-color: #00d1a3; transform: scale(1.05); }

    #registroVentas button {
        background-color: #00aaff;
        color: #fff;
    }

    #registroVentas button:hover { background-color: #008ecc; transform: scale(1.05); }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
        animation: fadeIn 0.5s ease-in;
    }

    th, td {
        padding: 12px;
        text-align: left;
    }

    th {
        background-color: #111;
        color: #00ffb3;
        border-bottom: 2px solid #00ffb3;
    }

    tr { transition: background 0.3s; }
    tr:nth-child(even) { background-color: rgba(0,255,179,0.1); }
    tr:hover { background-color: rgba(0,255,179,0.2); }

    .total {
        font-weight: bold;
        margin-top: 15px;
        color: #00ffb3;
        text-align: right;
    }

    #logout {
        background-color: #ff4c4c;
        color: white;
        margin-top: 15px;
    }

    #logout:hover { background-color: #e03e3e; transform: scale(1.05); }

    .filtro {
        margin-top: 20px;
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }

    .filtro button {
        background-color: #ffaa00;
        color: #111;
    }

    .filtro button:hover { background-color: #e68a00; transform: scale(1.05); }

    @keyframes fadeIn { from {opacity: 0;} to {opacity: 1;} }

    canvas {
        margin-top: 30px;
        background-color: rgba(0,0,0,0.2);
        border-radius: 10px;
        padding: 10px;
    }
</style>
</head>
<body>
<div class="container">
    <h1>Control de Ventas Diarias</h1>

    <!-- Login -->
    <div id="login">
        <input type="password" id="password" placeholder="Ingrese el código de acceso">
        <button onclick="verificarPassword()">Ingresar</button>
        <p id="loginError" style="color:red; display:none;">Código incorrecto.</p>
    </div>

    <!-- Registro de ventas -->
    <div id="registroVentas" style="display:none;">
        <div style="display:flex; gap:10px; flex-wrap:wrap;">
            <input type="date" id="fecha" style="flex:1;">
            <input type="number" id="efectivo" placeholder="Ventas en efectivo" min="0" style="flex:1;">
            <input type="number" id="tarjeta" placeholder="Ventas con tarjeta" min="0" style="flex:1;">
            <button onclick="agregarVenta()" style="flex:1;">Agregar registro</button>
        </div>

        <!-- Filtro por fechas -->
        <div class="filtro">
            <input type="date" id="fechaInicio" placeholder="Fecha inicio">
            <input type="date" id="fechaFin" placeholder="Fecha fin">
            <button onclick="filtrarFechas()">Filtrar</button>
            <button onclick="mostrarTodo()">Mostrar todo</button>
        </div>

        <table id="tablaVentas">
            <thead>
                <tr>
                    <th>Fecha</th>
                    <th>Efectivo (Q)</th>
                    <th>Tarjeta (Q)</th>
                    <th>Total (Q)</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <p class="total">Total acumulado: Q<span id="totalAcumulado">0.00</span></p>

        <canvas id="graficaVentas"></canvas>

        <button onclick="descargarCSV()" style="margin-top:20px;">Descargar CSV</button>
        <button id="logout" onclick="cerrarSesion()">Cerrar sesión</button>
    </div>
</div>

<script>
    const passwordCorrecto = "22782522";
    let ventas = [];

    function verificarPassword() {
        const pass = document.getElementById('password').value;
        if(pass === passwordCorrecto) {
            document.getElementById('login').style.display = 'none';
            document.getElementById('registroVentas').style.display = 'flex';
        } else {
            document.getElementById('loginError').style.display = 'block';
        }
    }

    function agregarVenta() {
        const fecha = document.getElementById('fecha').value;
        const efectivo = parseFloat(document.getElementById('efectivo').value);
        const tarjeta = parseFloat(document.getElementById('tarjeta').value);

        if(!fecha || isNaN(efectivo) || isNaN(tarjeta)) {
            alert("Ingrese datos válidos.");
            return;
        }

        const total = efectivo + tarjeta;
        ventas.push({fecha, efectivo, tarjeta, total});

        // Ordenar por fecha
        ventas.sort((a,b) => new Date(a.fecha) - new Date(b.fecha));

        actualizarTabla();
        actualizarGrafica();
        limpiarCampos();
    }

    function actualizarTabla(filtradas = null) {
        const tbody = document.getElementById('tablaVentas').querySelector('tbody');
        tbody.innerHTML = "";
        let acumulado = 0;

        const lista = filtradas || ventas;

        lista.forEach(v => {
            const tr = document.createElement('tr');
            tr.innerHTML = `<td>${v.fecha}</td>
                            <td>Q${v.efectivo.toFixed(2)}</td>
                            <td>Q${v.tarjeta.toFixed(2)}</td>
                            <td>Q${v.total.toFixed(2)}</td>`;
            tbody.appendChild(tr);
            acumulado += v.total;
        });

        document.getElementById('totalAcumulado').innerText = acumulado.toFixed(2);
    }

    function limpiarCampos() {
        document.getElementById('fecha').value = "";
        document.getElementById('efectivo').value = "";
        document.getElementById('tarjeta').value = "";
    }

    function descargarCSV() {
        let csv = "Fecha,Efectivo,Tarjeta,Total\n";
        ventas.forEach(v => {
            csv += `${v.fecha},${v.efectivo.toFixed(2)},${v.tarjeta.toFixed(2)},${v.total.toFixed(2)}\n`;
        });

        const blob = new Blob([csv], {type: 'text/csv'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `ventas_diarias.csv`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
    }

    function cerrarSesion() {
        document.getElementById('registroVentas').style.display = 'none';
        document.getElementById('login').style.display = 'flex';
        document.getElementById('password').value = "";
        document.getElementById('loginError').style.display = 'none';
    }

    // Filtro por fechas
    function filtrarFechas() {
        const inicio = document.getElementById('fechaInicio').value;
        const fin = document.getElementById('fechaFin').value;

        if(!inicio || !fin) {
            alert("Seleccione ambas fechas para filtrar.");
            return;
        }

        const filtradas = ventas.filter(v => v.fecha >= inicio && v.fecha <= fin);
        actualizarTabla(filtradas);
        actualizarGraficaFiltrada(filtradas);
    }

    function mostrarTodo() {
        actualizarTabla();
        actualizarGrafica();
        document.getElementById('fechaInicio').value = "";
        document.getElementById('fechaFin').value = "";
    }

    // Gráfica
    let grafica;
    function actualizarGrafica(filtradas = null) {
        const ctx = document.getElementById('graficaVentas').getContext('2d');
        const lista = filtradas || ventas;
        const etiquetas = lista.map(v => v.fecha);
        const efectivo = lista.map(v => v.efectivo);
        const tarjeta = lista.map(v => v.tarjeta);

        if(grafica) grafica.destroy();

        grafica = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: etiquetas,
                datasets: [
                    { label: 'Efectivo', data: efectivo, backgroundColor: '#00ffb3' },
                    { label: 'Tarjeta', data: tarjeta, backgroundColor: '#00aaff' }
                ]
            },
            options: {
                responsive: true,
                plugins: {
                    title: { display: true, text: 'Ventas Diarias', color:'#00ffb3', font:{size:20} },
                    legend: { labels:{ color:'#e0e0e0' } }
                },
                scales: {
                    x: { ticks:{ color:'#e0e0e0' }, grid:{ color:'rgba(255,255,255,0.1)' } },
                    y: { beginAtZero:true, ticks:{ color:'#e0e0e0' }, grid:{ color:'rgba(255,255,255,0.1)' } }
                },
                animation: { duration: 800 }
            }
        });
    }

    function actualizarGraficaFiltrada(filtradas) {
        actualizarGrafica(filtradas);
    }
</script>
</body>
</html>
